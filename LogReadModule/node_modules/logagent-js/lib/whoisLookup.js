var whois = require('node-whois')

function lookup (ip, callback)
{
	
	whois.lookup(ip, function(err, data) {
	   // console.log(data)
	    try {
	    if(!data) {
	    	callback('no data')
	    }
	    var lines = data.split ('\n')
	    lines = lines.filter (function (e,i){
	    	 if (/^\%/im.test(e))
	    	 	return false;
	    	 else if ( e == '') 
	    	 	return false
	    	 else if (/descr/i.test (e))
	    	 	return true
	    	 else false
	    })
	    lines = lines.map (function (e,i) {
	    	if (/descr/i.test (e))
	    	{
	    		var x = e.replace (/descr\:\s+/, '')
	    		return  x;
	    	} else {
	    		''
	    	}
	    })
	    callback (null, {description: lines.join ('\n'), original: data})
	} catch (ex) {
		console.log (ex)
		callback(ex) 
	}
	})
	
}
module.exports=lookup

